\section{Phân tích từ vựng}
\subsection{Mục đích và nhiệm vụ}
Nhiệm vụ chính của phần phân tích từ vựng là đọc các ký tự vào từ văn bản chương trình nguồn và đưa ra lần lượt các từ tố cùng một số thông tin thuộc tính.

\vspace{1cm}
\hspace{-1cm}
\begin{figure}[h]
    % \centering
    \begin{tikzpicture}[
        % roundnode/.style={circle, draw=green!60, fill=green!5, very thick, minimum size=7mm},
        squarednode/.style={rectangle, draw=red!60, fill=red!5, very thick, minimum size=5mm},
        ]
        %Nodes
        \node[squarednode,text width=2.5cm,align=center](lexer){Phân tích từ vựng};
        \node[text width=3cm,align=center](source)[left=of lexer]{Chương trình nguồn};
        \node[squarednode,text width=3cm,align=center](parser)[right=of lexer,xshift = 2cm] {Phân tích cú pháp};
        \node[squarednode,text width=3cm,align=center](tableofsymbols)[below=of lexer, xshift = 3cm, yshift = -0.5cm] {Bảng ký hiệu};
        \node[](nothing)[right=of parser]{}; 
        \node[text width=5cm,align=center](textabove)[above=of lexer,xshift = 3cm, yshift = -1.2cm]{Yêu cầu lấy từ tố tiếp theo}; 
        \node[text width=3cm,align=center](textbelow)[below=of lexer,xshift = 3cm, yshift = 1.2cm]{Từ tố}; 
    
        %Lines
        \draw[->] (source) -- (lexer);
        \draw[->] ([yshift = 2mm]lexer.east) -- ([yshift = 2mm]parser.west);
        \draw[<->] (lexer.south) |- ([yshift = 2mm]tableofsymbols.west);
        \draw[->] ([yshift = -2mm]parser.west) -- ([yshift = -2mm]lexer.east) ;
        \draw[<->] (tableofsymbols.east)  -| (nothing.south);
        \draw[->,dashed] (parser.east) -- (nothing.west) ;
    \end{tikzpicture}
    \caption{Vị trí của phần phân tích từ vựng trong trình biên dịch.}
    \label{fig:pos-of-lexer}
\end{figure}
% \begin{tikzpicture}[
%     % roundnode/.style={circle, draw=green!60, fill=green!5, very thick, minimum size=7mm},
%     squarednode/.style={rectangle, draw=red!60, fill=red!5, very thick, minimum size=5mm},
%     ]
%     %Nodes
%     \node[squarednode,text width=2.5cm,align=center](lexer){Phân tích từ vựng};
%     \node[text width=3cm,align=center](source)[left=of lexer]{Chương trình nguồn};
%     \node[squarednode,text width=3cm,align=center](parser)[right=of lexer,xshift = 2cm] {Phân tích cú pháp};
%     \node[squarednode,text width=3cm,align=center](tableofsymbols)[below=of lexer, xshift = 3cm, yshift = -0.5cm] {Bảng ký hiệu};
%     \node[](nothing)[right=of parser]{}; 
%     \node[text width=5cm,align=center](textabove)[above=of lexer,xshift = 3cm, yshift = -1.2cm]{Yêu cầu lấy từ tố tiếp theo}; 
%     \node[text width=3cm,align=center](textbelow)[below=of lexer,xshift = 3cm, yshift = 1.2cm]{Từ tố}; 

%     %Lines
%     \draw[->] (source) -- (lexer);
%     \draw[->] ([yshift = 2mm]lexer.east) -- ([yshift = 2mm]parser.west);
%     \draw[<->] (lexer.south) |- ([yshift = 2mm]tableofsymbols.west);
%     \draw[->] ([yshift = -2mm]parser.west) -- ([yshift = -2mm]lexer.east) ;
%     \draw[<->] (tableofsymbols.east)  -| (nothing.south);
%     \draw[->,dashed] (parser.east) -- (nothing.west) ;
% \end{tikzpicture}
\vspace{1cm}


Phần này có thể coi là phần tiền xử lý văn bản chương trình nguồn, làm cho nhiệm vụ của các giai đoạn sau đơn giản hơn. Quá trình này bao gồm các công việc:

1. {\itshape Xóa bỏ các ký tự không có nghĩa.} Các chú thích, dòng trống, các ký tự xuống dòng, dấu tab, các khoảng trắng không cần thiết đều bị xóa bỏ.

2. {\itshape Nhận dạng các ký hiệu.} Nhận dạng các ký tự liền nhau tạo thành một ký hiệu. Các dạng ký hiệu này gọi là các từ tố. Các từ tố có thể là:

a. Từ khóa như \textbf{when, for, \dots};

b. Tên của biến, hàm, \dots;

c. Các số như 12, 4, 3.14, \dots;

d. Xâu, nằm trong cặp dấu nháy kép (")

e. Ký tự, nằm trong cặp dấu nháy đơn (')

\dots

3. {\itshape Số hóa ký hiệu.} Do các con số được xử lí dễ dàng hơn là các xâu, từ khóa, tên nên các xâu sẽ được thay bằng số, các chứ số sẽ được đổi thành số thật sự biểu diễn trong máy. Quá trình này được gọi là số hóa.

Ngoài ra, bộ phân tích từ vựng còn làm một nhiệm vụ phụ: đóng vai trò giao diện với người dùng. Nó xóa bỏ các ký tự thừa như các khoảng trắng, các chú thích, các ký tự hết dòng\dots\space làm cho chương trình không phụ thuộc vào chúng. Như vậy cũng có nghĩa nó cho phép người lập trình trình bày chương trình nguồn của mình tùy ý và dễ đọc hơn. Mặt khác, đây là phần duy nhất lưu các thông tin phụ về từ tố như số dòng, số cột của nó, \dots\space cho phép bộ phận báo lỗi chỉ chính xác nơi xảy ra lỗi trong chương trình nguồn. Nếu ngôn ngữ nguồn cho phép dùng các hàm macro, thì việc xử lí các macro cũng thường được đặt trong phần này.

\subsection{Sự cần thiết phải tách rời phân tích từ vựng với phân tích cú pháp}
Như trên đã trình bày, phần phân tích của chương trình dịch bao gồm 3 phần là: phân tích từ vựng, phân tích cú pháp, phân tích ngữ nghĩa. Trước đây phần phân tích từ vựng và phân tích cú pháp có thể viết chung làm một khối. Bây giờ có một số lý do để ta nên chia hai phần phân tích này tách rời nhau:

1. Thiết kế từng phần đơn giản hơn. Đây là lý do quan trọng nhất, phù hợp với các quy tắc thiết kế và bảo dưỡng chương trình.

2. Tính năng của chương trình dịch được cải tiến. Bộ phân tích từ vựng có thể cải tiến để nâng cao tốc độ phân tích, bộ phân tích cú pháp phân tích được các cấu trúc phức tạp hơn. Ngoài ra, có một số công cụ trợ giúp chỉ có thể thêm vào sau khi hai bộ phận này đã được tách rời nhau.

3. Cho phép chương trình dịch có thể chuyển đổi. Ví dụ như khi thay đổi bảng mã ký tự, quy ước lại các ký hiệu \dots\space thì việc sửa đổi sẽ ít, dễ dàng và chính xác hơn.

Phân tích từ vựng là phần đơn giản nhất của chương trình dịch. Tuy vậy, nó lại chiếm một phần khá lớn trong tổng số thời gian dịch (thường chiếm 20-40\%) do phải làm việc trực tiếp với chương trình nguồn ghi trên các thiết bị lưu trữ ngoài có tốc độ chậm (như ổ đĩa), điều đó cũng có nghĩa tác dụng cải tiến của nó đặc biệt quan trọng.

\subsection{Các giai đoạn phân tích từ vựng của trình biên dịch Pandora}
Quy trình phân tích cú pháp trong hệ thống của chúng em bao gồm ba giai đoạn chính:

\textbf{Giai đoạn 1.} \textit{Phân tích từ tố sơ cấp.}

\textbf{Giai đoạn 2.} \textit{Phân tích từ tố thứ cấp.}

\textbf{Giai đoạn 3.} \textit{Phân tích cây từ tố.}

Đầu tiên, mã nguồn được chia nhỏ thành các từ tố sơ cấp (\textit{Token trong gói lexer}) – những phần tử cơ bản nhất như tên, toán tử, và ký tự đặc biệt, \dots Sau đó, ở giai đoạn tiếp theo, các token sơ cấp này được xử lý để tạo thành token thứ cấp (\textit{Token trong gói ast}) bằng cách loại bỏ các khoảng trắng, comment không cần thiết. Cuối cùng, các token thứ cấp được nhóm lại (đồng thời kết hợp các token có thể ghép lại, ví dụ như '<' và '=' thành "<=", \dots) để tạo thành cây từ tố (\textit{TokenTree trong gói ast::tokenstream}), giúp biểu diễn cấu trúc cú pháp của mã nguồn, tạo nền tảng cho quá trình phân tích cú pháp, phân tích ngữ nghĩa và biên dịch. Chi tiết sẽ được chúng em trình bày như dưới đây:
